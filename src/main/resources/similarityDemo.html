<html>
<head>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<!-- <script language="javascript" type="text/javascript" src=" {{ url_for('static',filename='lawnchair-0.6.1.min.js') }} "></script> -->
<script language="javascript" type="text/javascript" src="https://raw.github.com/Mottie/tablesorter/master/js/jquery.tablesorter.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<link href="/static/sparc-bootstrap.css" rel="stylesheet" type="text/css" />
<link href="/static/styles.css" rel="stylesheet" type="text/css" />
</head>
<body class="darkNav">

	<div class="container">

		<img src="/static/sparciq-logo.png" class="logo" alt="SPARCIQ" />
		<h3 class="similarity">Similarity API</h3>

		<input id="question" class="question" type="text" name="question" value="Ask your question here." />

		<div id="data"></div>

		<div class="footer">
	    	<p>Copyright &copy; SPARC, LLC. All Rights Reserved.</p>
	    </div>
	</div>



</div>

<script>

var main = {
	getSimiarityData : function(question, cb) {
		$("#data").html('');
		$.ajax({
			url: "similarity",
			type: "POST",
			contentType: "application/json",
			dataType: "json",
			data: JSON.stringify(question),
			success: function(response){
				$('#data').empty();

				var globalData = {};
				var items = response.similarity;

				if (typeof items === 'string') {
					$('#data')
	        			.empty()
	        			.append(
	        				$('<p />')
	        					.addClass('response response-warning')
	        					.html('No responses for your question.')
	        			);

					return;
				}
				// add questions
				if(items.length){
					for(var j= items.length;j--;){
						var item = items[j]
						globalData[item.id] = {'question':item.document, "simScore" : item.similarityScore}
					}
					var $table = $('#data'),
						$compdoc = $('#comparisonDocument'),
						items = globalData,
						firstHeader = 'ID',
						secondHeader = 'Question',
						thirdHeader = 'Similarity',
						tableHTML = '<table dir="ltr" class="tablesorter table table-striped table-bordered" id="myTable" summary="purpose/structure for speech output">'+
		                        '<colgroup width="20%" />'+
		                        '<colgroup id="colgroup" class="" title="title" span="3" />'+
		                        '<thead> <tr>  <th>'+firstHeader+'</th> <th>'+secondHeader+'</th><th>'+thirdHeader+'</th> </tr> </thead><tbody>';
			        for(var key in globalData){
			            var title = key;
			            var value = globalData[key].question;
			            var sim = globalData[key].simScore ? globalData[key].simScore : 0;
			            if(sim){
			            	sim = Math.round(sim*100);
			            }
			            tableHTML += '<tr><td>'+ title+'</td><td>'+ value +'</td><td>'+sim+'%</td></tr>'
		        	}

		        	tableHTML += '</tbody></table>';
		        	$table.append(tableHTML);

		        	// add compdoc
		        	$compdoc.html("Question asked: "  + question.data.document.value);

		        	cb();
	        	}
	        	else {
	        		$('#data')
	        			.empty()
	        			.append(
	        				$('<p />')
	        					.addClass('response response-error')
	        					.html('Error loading data.')
	        			);

	        	}
			},
			error: function(response){
				$('#data')
	        			.empty()
	        			.append(
	        				$('<p />')
	        					.addClass('response response-error')
	        					.html('Error loading data.')
	        			);
			}
		})
},
	addTableSorter : function(){
		$('#myTable').tablesorter({sortList: [[2,1]]});
	}
};



$(function() {
	var defaultText = 'Ask the wise one.';

	$('#question')
		.val(defaultText)
		.live('click', function() {
			var question = $(this).val();

			if (question === defaultText) {
				$(this).val('');
			}
		})
		.live('change', function() {
			var question = $(this).val();

			if (question !== '')
				if(!question.length){
					alert("please enter question");
					return false;
				}
				else {
					main.getSimiarityData({"data":{"document":{"title": "doc", "value": question}}},main.addTableSorter);
					return false;
				}
		});

});

</script>
</body>
</html>